# 스위치
데이터 링크 계층에서 지원하는 장비는 '스위치'가 있다.

\스위치가 전달받은 신호를 원하는 포트로만 내보낼 수 있는 것은 스위치가 MAC 주소를 학습할 수 있기 때문이다.

스위치를 사용하면 논리적으로 LAN을 분리하는 가상의 LAN, 즉 VLAN을 구성할 수 있다는 장점이 있다.

## 스위치란?
2계층에서 사용한다 하여 'L2 스위치'라고도 한다.
스위치의 여러 포트에는 호스트를 연결할 수 있는데 이런 점은 '허브'와 유사하다.
다만 스위치는 허브와는 달리 MAC 주소를 학습해 특정 MAC 주소를 가진 호스트에만 프레임을 전달할 수 있고 '전이중 모드'의 통신을 지원한다.

그렇기에 스위치를 이용하면 포트별로 콜리전 도메인이 나뉘고, CSMA/CD 프로토콜이 필요치않다.

### 스위치의 특징

- MAC 주소 학습

영상 자료 
https://www.youtube.com/watch?v=Q9yiKrR1lWI

![플러딩](https://blog.kakaocdn.net/dn/mhHFN/btq1nH0wDQ5/8ssYLzyVpv56q4rkCzeeT1/img.gif)
1. 플러딩, flooding
스위치는 부팅시 네트워크 관련 정보가 아무것도 없는 상태이다.
이때 스위치는 제 역할을 못하고 '허브'처럼 동작한다.

허브는 통신이 들어온 패킷을 제외하고 모든 포트에 패킷을 전달한다.
스위치도 이와 같은 행위를 하는데 이것을 '플러딩'이라 한다.

2. 어드레스러닝
MAC 주소 테이블을 만들고 유지하는 과정을 어드레스러닝이라한다.
패킷이 특정 포트에 들어오면 스위치에는 해당 패킷의 출발지와 MAC 주소와 포트번호를 MAC 주소 테이블에 기록한다.

💡 어드레스러닝은 출발지의 MAC의 주소 정보를 사용하므로 브로드캐스트나 멀티캐스에 대한 MAC 주소를 학습할 수 없다.

3. 포워딩,forwarding / 필터링, filtering
패킷이 스위치에 들어오면 도착지 MAC 주소를 확인하고 자신이 가진 MAC 테이블과 매칭하여 맞는 정보가 있으면 '포워딩' 한다.

다른 포트로 해당 패킷을 보내지 않는 동작을 '필터링'이라 한다.


4. 에이징, aging
만약 MAC 주소 테이블에 등록된 특정 포트에서 일정 시간동안 프레임을 전송받지 못했다면 해당 항목을 삭제한다.
이를 '에이징'이라 한다.


### VLAN, Virtual LAN 
이름 그대로 한다의 스위치로 가상의 LAN을 만드는 방법

허브는 송신지 포트를 제외한 모든 포트로 신호를 보내서 네트워크 상 불필요한 트래픽이 늘어날 수 밖에 없고 이는 성능 저하로 이어진다.

스위치도 마찬가지인데 연결된 호스트 중에서도 서로 메시지를 주고 받을 일이 적거나 브로드캐스트 메시지를 받을 필요가 없어서 굳이 네트워크(LAN)에 속할 필요가 없는 호스트가 존재할 수 있다.
이들을 분리하고자 스위치 장비를 매번 새로 구비하는 것은 낭비이기에 이때 구성하는 것이 'VLAN'이다.

VLAN을 구성하면 한 대의 물리적 스위치라 해도 여러 대의 스위치가 있는 것처럼 논리적 단위로 LAN을 구획할 수 있다.

![VLAN](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F6nEOW%2FbtrHdxblYX6%2F7uKhQDBnuGB0sxDKdXjddK%2Fimg.webp)
참고: https://eveningdev.tistory.com/74

VLAN1과 VLAN2에 속한 호스트가 통신하고자 하면 데이터 링크 계층의 장비가 아닌 네트워크 계층 이상의 상위 계층 장비가 필요하다.
또한 브로드캐스트 도메인도 달라진다.

### 포트 기반의 VLAN, port based VLAN
스위치의 포트가 VLAN을 결정하는 방식

사전에 특정 포트에 VLAN을 할당하고, 해당 포트에 호스트를 연결함으로써 VLAN에 포함시킬 수 있다.

그런데 한 대의 스위치만으로 포트 기반 VLAN을 나누면 문제가 발생할 수 있다.
포트 수가 부족해질수 있기 때문인데, VLAN 스위치 여러 대를 구비해 같은 VLAN 포트끼리 연결하여 VLAN을 확장하는 방법도 있지만 이 또한 포트의 낭비이다.

이때 'VLAN 트렁킹'(VLAN Trunking)은 두 대 이상의 VLAN 스위치를 효율적으로 연결하여 확장하는 방법이다
스위치 간의 통신을 위한 특별한 포트인 '트렁크 포트'에 VLAN 스위치를 서로 연결하는 방식

### MAC 기반 VLAN
사전에 설정된 MAC 주소를 따라 VLAN이 연결되는 MAC 기반 VLAN도 있다.

이는 포트가 VLAN을 결정하는 것이 아닌 송수신하는 프레임 속 MAC 주소가 호스트가 속할 VLAN을 결정하는 방식이다.
